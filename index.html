<!DOCTYPE html>
<meta charset=UTF-8>
<title>Datalunch</title>
<style>
  body {
    font-size: 16px;
  }
  section{
    display: flex;
  }
  ul.categories,
  ul.fiches {
    display: flex;
    flex-direction: column;
    padding: .5em;
    font-size: 1.5em;
    list-style: none;
    border: 1px solid grey;
    width: 8em;
  }
  ul.fiches{
    width: 20em;
    margin: 0 2em;
  }
</style>

<section class=container>
  <ul class=categories></ul>
  <ul class=fiches></ul>
</section>

<template name=categories>
    <li><a href=# data-cat=title></a></li>
</template>

<template name=fiches>
    <li><a href=# data-fiche=title></a></li>
</template>

<script>
  const getCategories = files => files
    .filter(file => file.meta)
    .map(file => file.meta.categorie)
    .filter((elt, pos, arr) => arr.indexOf(elt) === pos)
    .sort()
  const importFiles = () => fetch('https://api.daktary.com/infolab-cd33/datalunch-/tree/master/fiches')
    .then(response => response.json())
  const displayCategories = (container, categories) => {
    categories.forEach(category => {
      const tpl = document
        .querySelector('template[name=categories]')
        .cloneNode(true)
        .content
        .querySelector('li')
      const tplTitle = tpl.querySelector('[data-cat=title]')
      tplTitle.href = '#' + category
      tplTitle.append(category)
      container.append(tpl)
    })
  }
  const displayFiles = (container, files) => {
    files.forEach(file => {
      const tpl = document
        .querySelector('template[name=fiches]')
        .cloneNode(true)
        .content
        .querySelector('li')
      const tplTitle = tpl.querySelector('[data-fiche=title]')
      console.log(file)
      tplTitle.href = file.link
      tplTitle.append(file.meta.title)
      container.append(tpl)
    })
  }
  importFiles().then(json => {
    const container = document.querySelector('.categories')
    const categories = getCategories(json.body)
    displayCategories(container, categories)
  })
  importFiles().then(json => {
    const container = document.querySelector('.fiches')
    displayFiles(container, json.body)
  })
</script>